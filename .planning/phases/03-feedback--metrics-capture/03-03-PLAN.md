---
phase: 03-feedback--metrics-capture
plan: 03
type: execute
wave: 1
depends_on: ["03-01"]
files_modified:
  - components/Timer.tsx
  - app/practice/[id].tsx
  - types/index.ts
  - lib/storage.ts
  - __tests__/lib/storage.test.ts
autonomous: true
must_haves:
  truths:
    - "Users can mark attention lapses during a session"
    - "Longest uninterrupted focus interval is calculated from lapse events"
  artifacts:
    - path: "components/Timer.tsx"
      provides: "Elapsed time callback"
    - path: "app/practice/[id].tsx"
      provides: "Lapse tracking UI"
  key_links:
    - from: "app/practice/[id].tsx"
      to: "components/Timer.tsx"
      via: "onTick / elapsed seconds"
      pattern: "onTick"
---

<objective>
Add in‑session lapse tracking and compute the longest uninterrupted focus interval.

Purpose: capture deliberate‑practice feedback loops beyond self‑report.
Output: lapse button, elapsed time tracking, and computed longest interval stored on session completion.
</objective>

<execution_context>
@/Users/richardyu/.claude/get-shit-done/workflows/execute-plan.md
@/Users/richardyu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-feedback--metrics-capture/03-RESEARCH.md

@components/Timer.tsx
@app/practice/[id].tsx
@types/index.ts
@lib/storage.ts
</context>

<tasks>

<task type="auto">
  <name>Expose elapsed time from Timer</name>
  <files>components/Timer.tsx</files>
  <action>
    - Add an optional `onTick(elapsedSeconds)` callback invoked during timer updates.
    - Ensure no performance regression (call once per second as the timer updates).
  </action>
  <verify>
    - Practice session can access elapsed time while timer runs.
  </verify>
  <done>
    - Timer emits elapsed seconds to parent.
  </done>
</task>

<task type="auto">
  <name>Add lapse tracking UI + compute longest interval</name>
  <files>app/practice/[id].tsx</files>
  <action>
    - Add a "Mark Lapse" button during the practice phase.
    - Track elapsed time of each lapse event and compute longest interval between lapses.
    - On completion, save lapseCount and longestFocusIntervalSec in session data.
    - Pass these values forward to the post‑session check‑in screen if available.
  </action>
  <verify>
    - Lapse count increments; longest interval updates as expected.
  </verify>
  <done>
    - Session stores lapseCount and longestFocusIntervalSec.
  </done>
</task>

</tasks>

<verification>
- Lapse tracking stores metrics for each session.
</verification>

<success_criteria>
- Longest uninterrupted interval is captured without extra user friction.
</success_criteria>

<output>
After completion, create `.planning/phases/03-feedback--metrics-capture/03-03-SUMMARY.md`
</output>
