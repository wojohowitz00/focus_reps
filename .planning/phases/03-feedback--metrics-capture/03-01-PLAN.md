---
phase: 03-feedback--metrics-capture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - types/index.ts
  - lib/storage.ts
  - lib/progress.ts
  - __tests__/lib/storage.test.ts
autonomous: true
must_haves:
  truths:
    - "Practice sessions can store focus quality, mood, stress, energy, lapse count, and longest focus interval"
    - "Storage supports updating an existing session with post-session metrics"
  artifacts:
    - path: "types/index.ts"
      provides: "Extended PracticeSession metrics fields"
    - path: "lib/storage.ts"
      provides: "Session update helper"
  key_links:
    - from: "lib/storage.ts"
      to: "types/index.ts"
      via: "PracticeSession"
      pattern: "PracticeSession"
---

<objective>
Extend the data model and storage to capture post‑session survey metrics and lapse data.

Purpose: enable Phase 03 feedback loop while keeping local‑only storage.
Output: updated PracticeSession type + storage update helper + tests.
</objective>

<execution_context>
@/Users/richardyu/.claude/get-shit-done/workflows/execute-plan.md
@/Users/richardyu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-feedback--metrics-capture/03-RESEARCH.md

@types/index.ts
@lib/storage.ts
@lib/progress.ts
@__tests__/lib/storage.test.ts
</context>

<tasks>

<task type="auto">
  <name>Add session metrics fields and update defaults</name>
  <files>types/index.ts, lib/progress.ts</files>
  <action>
    - Extend `PracticeSession` with optional fields: focusQuality, mood, stress, energy (1–5), lapseCount (int), longestFocusIntervalSec (number).
    - Ensure any default settings object includes required new fields if needed.
  </action>
  <verify>
    - TypeScript builds (no type errors in updated usage).
  </verify>
  <done>
    - PracticeSession can store feedback metrics and lapse data.
  </done>
</task>

<task type="auto">
  <name>Add session update helper in storage</name>
  <files>lib/storage.ts, __tests__/lib/storage.test.ts</files>
  <action>
    - Add `updateSession(id, updates)` or `updateSessionMetrics(id, metrics)` to update an existing session.
    - Ensure updates merge without losing existing fields.
    - Add unit test that updates metrics on an existing session.
  </action>
  <verify>
    - `npm test -- __tests__/lib/storage.test.ts` passes.
  </verify>
  <done>
    - Stored sessions can be updated after post‑session survey.
  </done>
</task>

</tasks>

<verification>
- Session metrics can be saved and retrieved.
- Storage update helper works with tests.
</verification>

<success_criteria>
- Data model is ready for survey and lapse capture UI.
</success_criteria>

<output>
After completion, create `.planning/phases/03-feedback--metrics-capture/03-01-SUMMARY.md`
</output>
